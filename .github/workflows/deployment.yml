name : Continuous Deployment

# only runs when the is actually merged to main branch
on :
  push:
    # only when there is a push on main branch
    branches : ["main"]

jobs:
  build-and-deploy:
    runs-on : ubuntu-latest

    steps :
    # setup
    - name : Setup
      uses : actions/checkout@v4

    # dockerhub login
    - name : Login to Docker
      uses : docker/login-action@v2
      with :
        username : ${{ secrets.DOCKER_USERNAME }}
        password : ${{ secrets.DOCKER_PASSWORD }}

    # build and push the backend image to dockerhub
    - name : Build and Push Backend
      uses : docker/build-push-action@v5
      with :
        context : ./backend
        push : true
        tags : ${{ secrets.DOCKER_USERNAME }}/ecommerce-application-backend:latest

    # build and push the frontend image to dockerhub
    - name :  Build and Push Frontend
      uses : docker/build-push-action@v5
      with :
        context : ./frontend
        push : true
        tags : ${{ secrets.DOCKER_USERNAME }}/ecommerce-application-frontend:latest